<div class="container">
  <!-- Page Header -->
  <app-page-header
    title="Álbuns"
    subtitle="Gerencie o catálogo de álbuns musicais"
    icon="album">
    <button mat-flat-button color="primary" (click)="createAlbum()">
      <mat-icon>add</mat-icon>
      <span class="hide-mobile">Novo Álbum</span>
    </button>
  </app-page-header>

  <!-- Filters Toolbar -->
  <div class="filters-toolbar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar álbum</mat-label>
      <input matInput
             [value]="searchTerm"
             (input)="onSearch($event)"
             placeholder="Digite o título do álbum">
      <mat-icon matPrefix>search</mat-icon>
      <button mat-icon-button
              matSuffix
              *ngIf="searchTerm"
              (click)="clearSearch()"
              matTooltip="Limpar busca">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <div class="filter-actions">
      <button mat-stroked-button
              class="sort-btn"
              (click)="onSortChange()"
              matTooltip="Ordenar {{ sortDirection === 'asc' ? 'Z-A' : 'A-Z' }}">
        <mat-icon>sort_by_alpha</mat-icon>
        <mat-icon class="sort-arrow">{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
      </button>

      <button mat-stroked-button
              color="primary"
              class="clear-btn"
              (click)="clearFilters()"
              *ngIf="searchTerm">
        <mat-icon>filter_alt_off</mat-icon>
        <span class="hide-mobile">Limpar</span>
      </button>
    </div>
  </div>

  <!-- Results Info -->
  <div class="results-info" *ngIf="!loading && totalElements > 0">
    <span class="results-count">
      <strong>{{ totalElements }}</strong> álbum(ns) encontrado(s)
    </span>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="48"></mat-spinner>
    <p>Carregando álbuns...</p>
  </div>

  <!-- Albums Grid -->
  <div class="albums-grid" *ngIf="!loading && albums.length > 0">
    <div *ngFor="let album of albums; let i = index"
         class="album-card"
         [style.animation-delay]="i * 30 + 'ms'"
         (click)="viewAlbum(album)">
      <!-- Cover -->
      <div class="card-cover">
        <img *ngIf="album.coverUrl"
             [src]="album.coverUrl"
             [alt]="album.title"
             class="cover-img"
             loading="lazy">
        <div *ngIf="!album.coverUrl" class="cover-placeholder">
          <mat-icon>album</mat-icon>
        </div>
        <div class="cover-actions">
          <button mat-mini-fab
                  color="primary"
                  (click)="viewAlbum(album); $event.stopPropagation()"
                  matTooltip="Ver detalhes">
            <mat-icon>visibility</mat-icon>
          </button>
        </div>
      </div>

      <!-- Info -->
      <div class="card-info">
        <h3 class="card-title" [matTooltip]="album.title">{{ album.title }}</h3>
        <p class="card-artist">{{ getArtistNames(album) }}</p>
        <div class="card-meta">
          <span class="meta-item" *ngIf="album.releaseYear">
            <mat-icon>event</mat-icon>
            {{ album.releaseYear }}
          </span>
          <span class="meta-item" *ngIf="album.genre">
            <mat-icon>music_note</mat-icon>
            {{ album.genre }}
          </span>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card-actions">
        <button mat-icon-button
                (click)="editAlbum(album); $event.stopPropagation()"
                matTooltip="Editar álbum">
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <app-empty-state
    *ngIf="!loading && albums.length === 0"
    icon="album"
    title="Nenhum álbum encontrado"
    [description]="searchTerm
      ? 'Nenhum álbum corresponde à busca. Tente ajustar os termos.'
      : 'Comece adicionando o primeiro álbum ao catálogo.'"
    [actionText]="searchTerm ? 'Limpar busca' : 'Adicionar álbum'"
    [actionIcon]="searchTerm ? 'filter_alt_off' : 'add'"
    (actionClick)="searchTerm ? clearFilters() : createAlbum()">
  </app-empty-state>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalElements > pageSize">
    <mat-paginator
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>

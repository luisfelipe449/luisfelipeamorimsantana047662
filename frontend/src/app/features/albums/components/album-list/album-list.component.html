<div class="max-w-7xl mx-auto p-6 max-md:p-4">
  <!-- Main Card Container -->
  <div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 max-md:p-4 max-md:flex-col max-md:items-start max-md:gap-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-primary-50 flex items-center justify-center">
          <mat-icon class="text-primary">album</mat-icon>
        </div>
        <div>
          <h2 class="text-lg font-semibold text-gray-900 m-0">Discografia</h2>
          <p class="text-sm text-gray-500 m-0">{{ totalElements }} álbuns cadastrados</p>
        </div>
      </div>
      <button mat-raised-button color="primary" (click)="createAlbum()">
        <mat-icon>add</mat-icon>
        Novo álbum
      </button>
    </div>

    <!-- Toolbar -->
    <div class="flex items-center gap-4 px-6 pb-6 max-md:px-4 max-md:flex-col max-md:gap-3">
      <!-- Search Input -->
      <mat-form-field appearance="outline" class="flex-1 toolbar-input max-md:w-full">
        <mat-icon matPrefix class="text-gray-400 mr-1">search</mat-icon>
        <input matInput
               [value]="searchTerm"
               (input)="onSearch($event)"
               placeholder="Buscar álbum...">
        <button mat-icon-button matSuffix *ngIf="searchTerm" (click)="clearSearch()">
          <mat-icon class="text-gray-400">close</mat-icon>
        </button>
      </mat-form-field>

      <!-- Filters Group -->
      <div class="flex items-center gap-2 max-md:w-full max-md:justify-end">
        <!-- Sort Button -->
        <button mat-stroked-button
                class="!min-w-0 !px-3 !h-[40px]"
                (click)="onSortChange()"
                matTooltip="Ordenar {{ sortDirection === 'asc' ? 'Z-A' : 'A-Z' }}">
          <mat-icon class="!mr-0">sort_by_alpha</mat-icon>
          <mat-icon class="icon-xs !ml-0">{{ sortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
        </button>

        <!-- View Mode Toggle -->
        <div class="flex border border-gray-200 rounded-lg overflow-hidden">
          <button mat-icon-button
                  class="!rounded-none btn-icon-md"
                  [class.bg-gray-100]="viewMode === 'list'"
                  (click)="setViewMode('list')"
                  matTooltip="Visualização em lista">
            <mat-icon>view_list</mat-icon>
          </button>
          <button mat-icon-button
                  class="!rounded-none btn-icon-md"
                  [class.bg-gray-100]="viewMode === 'grid'"
                  (click)="setViewMode('grid')"
                  matTooltip="Visualização em grade">
            <mat-icon>grid_view</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="flex flex-col items-center justify-center min-h-[300px] gap-4 text-gray-500" *ngIf="loading">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Carregando álbuns...</p>
    </div>

    <!-- List View -->
    <div class="divide-y divide-gray-100" *ngIf="!loading && albums.length > 0 && viewMode === 'list'">
      <!-- Sort Indicator -->
      <div class="px-6 py-2 bg-gray-50 border-b text-sm text-gray-600 flex items-center gap-2">
        <mat-icon class="icon-xs">sort</mat-icon>
        <span>Ordenado por título: {{ sortDirection === 'asc' ? 'A → Z' : 'Z → A' }}</span>
      </div>

      <div *ngFor="let album of albums; let i = index"
           class="album-row flex items-center gap-4 py-4 px-6 cursor-pointer transition-colors hover:bg-gray-50 max-md:px-4"
           (click)="viewAlbum(album)">
        <!-- Row Number -->
        <span class="text-gray-400 text-sm w-6 text-center shrink-0">{{ (currentPage * pageSize) + i + 1 }}</span>

        <!-- Cover -->
        <div class="w-14 h-14 rounded-lg overflow-hidden bg-gray-100 shrink-0">
          <img *ngIf="album.coverUrl"
               [src]="album.coverUrl"
               [alt]="album.title"
               class="w-full h-full object-cover">
          <div *ngIf="!album.coverUrl"
               class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
            <mat-icon class="text-gray-400">album</mat-icon>
          </div>
        </div>

        <!-- Info -->
        <div class="flex-1 min-w-0">
          <div class="font-medium text-gray-900 truncate">{{ album.title }}</div>
          <div class="text-sm text-gray-500 flex items-center gap-1 flex-wrap">
            <span>{{ album.releaseYear }}</span>
            <span *ngIf="album.genre" class="text-gray-300">•</span>
            <span *ngIf="album.genre">{{ album.genre }}</span>
            <span *ngIf="album.trackCount" class="text-gray-300">•</span>
            <span *ngIf="album.trackCount" class="inline-flex items-center gap-0.5">
              <mat-icon class="icon-xs">music_note</mat-icon>
              {{ album.trackCount }} faixas
            </span>
            <span *ngIf="album.totalDuration" class="text-gray-300">•</span>
            <span *ngIf="album.totalDuration" class="inline-flex items-center gap-0.5">
              <mat-icon class="icon-xs">schedule</mat-icon>
              {{ formatDuration(album.totalDuration) }}
            </span>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-1 shrink-0">
          <button mat-icon-button
                  (click)="editAlbum(album); $event.stopPropagation()"
                  matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button
                  color="warn"
                  (click)="deleteAlbum(album); $event.stopPropagation()"
                  matTooltip="Excluir">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-6 max-md:p-4" *ngIf="!loading && albums.length > 0 && viewMode === 'grid'">
      <mat-card *ngFor="let album of albums; let i = index"
                class="album-card cursor-pointer relative overflow-hidden rounded-xl flex flex-col"
                [style.animation-delay]="i * 50 + 'ms'"
                (click)="viewAlbum(album)">

        <!-- Header with gradient and background image -->
        <div class="relative h-28 overflow-hidden bg-gradient-to-r from-primary to-primary-700">
          <img *ngIf="album.coverUrl"
               [src]="album.coverUrl"
               alt=""
               class="absolute inset-0 w-full h-full object-cover opacity-30">

          <!-- Badge in top right corner -->
          <div *ngIf="album.releaseYear" class="absolute top-3 right-3 px-3 py-1 rounded-full bg-white/90 text-sm font-medium inline-flex items-center gap-1 text-primary">
            <mat-icon class="icon-xs">calendar_today</mat-icon>
            <span>{{ album.releaseYear }}</span>
          </div>
        </div>

        <!-- Cover overlapping header -->
        <div class="relative px-4 -mt-10">
          <div class="w-20 h-20 rounded-xl border-4 border-white shadow-lg overflow-hidden bg-white">
            <img *ngIf="album.coverUrl"
                 [src]="album.coverUrl"
                 [alt]="album.title"
                 class="w-full h-full object-cover">
            <div *ngIf="!album.coverUrl"
                 class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
              <mat-icon class="icon-lg text-gray-400">album</mat-icon>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="p-4 pt-2 flex-1 flex flex-col">
          <h3 class="text-xl font-semibold text-gray-900 mb-1 line-clamp-2" [matTooltip]="album.title">{{ album.title }}</h3>

          <!-- Artists -->
          <p class="flex items-center gap-1 text-sm text-gray-500 mb-3">
            <mat-icon class="icon-xs">person</mat-icon>
            <span class="line-clamp-1">{{ getArtistNames(album) }}</span>
          </p>

          <!-- Genre and Stats -->
          <div class="text-gray-600 text-sm mb-4 flex-1">
            <div class="flex items-center gap-2 flex-wrap">
              <span *ngIf="album.genre" class="inline-flex items-center gap-1">
                <mat-icon class="icon-xs text-gray-400">music_note</mat-icon>
                <span>{{ album.genre }}</span>
              </span>
              <span *ngIf="album.genre && album.trackCount" class="text-gray-300">•</span>
              <span *ngIf="album.trackCount">{{ album.trackCount }} faixas</span>
            </div>
          </div>

          <!-- Statistics -->
          <div class="flex items-center gap-1 text-sm text-primary">
            <mat-icon class="icon-sm">people</mat-icon>
            <span class="font-semibold">{{ album.artists.length || 0 }}</span>
            <span class="text-gray-500">artista(s)</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-2 px-4 pb-4 pt-3 border-t border-gray-100">
          <button mat-stroked-button
                  class="flex-1"
                  (click)="viewAlbum(album); $event.stopPropagation()">
            <mat-icon>visibility</mat-icon>
            Ver detalhes
          </button>
          <button mat-icon-button
                  (click)="editAlbum(album); $event.stopPropagation()"
                  matTooltip="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button
                  color="warn"
                  (click)="deleteAlbum(album); $event.stopPropagation()"
                  matTooltip="Excluir">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div class="p-12 text-center" *ngIf="!loading && albums.length === 0">
      <mat-icon class="icon-2xl text-gray-300 mb-3">album</mat-icon>
      <h3 class="text-lg font-medium text-gray-900 mb-1">
        {{ searchTerm ? 'Nenhum álbum encontrado' : 'Nenhum álbum cadastrado' }}
      </h3>
      <p class="text-sm text-gray-500 mb-4">
        {{ searchTerm
          ? 'Nenhum álbum corresponde à busca. Tente ajustar os termos.'
          : 'Comece adicionando o primeiro álbum ao catálogo.' }}
      </p>
      <button mat-raised-button color="primary" (click)="searchTerm ? clearFilters() : createAlbum()">
        <mat-icon>{{ searchTerm ? 'filter_alt_off' : 'add' }}</mat-icon>
        {{ searchTerm ? 'Limpar busca' : 'Adicionar álbum' }}
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center mt-6 p-4 bg-white rounded-xl shadow-sm" *ngIf="totalElements > pageSize">
    <mat-paginator
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
